

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuration &mdash; Benji Backup 0.5.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/asciinema/asciinema-player.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Backup" href="backup.html" />
    <link rel="prev" title="Quick Start" href="quickstart.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Benji Backup
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#ubuntu-16-04">Ubuntu 16.04</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#centos-7">CentOS 7</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#redhat-enterprise-linux-7">Redhat Enterprise Linux 7</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#fedora-27-and-up">Fedora 27 and up</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#common-to-all-distributions">Common to All Distributions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#some-vocabulary">Some Vocabulary</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#backup">Backup</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#deep-scrub-and-scrub">Deep Scrub and Scrub</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#restore">Restore</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#version-removal-and-cleanup">Version Removal and Cleanup</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration-file-location">Configuration File Location</a></li>
<li class="toctree-l2"><a class="reference internal" href="#top-level-configuration-directives">Top-level configuration directives</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-of-i-o-configurations">List of I/O Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-of-transform-configurations">List of Transform Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-of-storage-configurations">List of Storage Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-o-modules">I/O Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#i-o-module-file">I/O Module file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#i-o-module-rbd">I/O Module rbd</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#transform-modules">Transform Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#transform-module-zstd">Transform Module zstd</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transform-module-aes-256-gcm">Transform Module aes_256_gcm</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#storage-modules">Storage Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hmac">HMAC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read-cache">Read Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storage-module-file">Storage Module file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storage-module-s3">Storage Module s3</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storage-module-b2">Storage Module b2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nbd">NBD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-instance-installations">Multiple Instance Installations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="backup.html">Backup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="backup.html#simple-backup">Simple Backup</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup.html#versions">Versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup.html#differential-backup">Differential Backup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="backup.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="backup.html#specifying-a-block-size">Specifying a block size</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup.html#labeling-versions">Labeling <em>Versions</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="backup.html#the-hints-file">The Hints File</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scrub.html">Scrub</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scrub.html#reasons-for-scrubbing">Reasons for Scrubbing</a></li>
<li class="toctree-l2"><a class="reference internal" href="scrub.html#scrubbing-methods">Scrubbing Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="scrub.html#consistency-and-checksum">Consistency and Checksum</a></li>
<li class="toctree-l3"><a class="reference internal" href="scrub.html#using-the-backup-source">Using the Backup Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="scrub.html#consistency-only">Consistency Only</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="scrub.html#batch-scrubbing">Batch scrubbing</a></li>
<li class="toctree-l2"><a class="reference internal" href="scrub.html#scrubbing-failures">Scrubbing Failures</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="restore.html">Restore</a><ul>
<li class="toctree-l2"><a class="reference internal" href="restore.html#full-restore">Full Restore</a><ul>
<li class="toctree-l3"><a class="reference internal" href="restore.html#restoring-without-a-database">Restoring without a database</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="restore.html#nbd-server">NBD Server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="restore.html#read-only-mount">Read-Only Mount</a></li>
<li class="toctree-l3"><a class="reference internal" href="restore.html#read-write-mount">Read-Write Mount</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="restore.html#restoring-invalid-versions">Restoring Invalid <em>Versions</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="enforce.html">Retention Policy Enforcement</a><ul>
<li class="toctree-l2"><a class="reference internal" href="enforce.html#policy-specification">Policy Specification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cleanup.html">Cleanup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cleanup.html#removing-old-versions">Removing old versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cleanup.html#id1">Cleanup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="administration.html">Administration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="administration.html#securing-version-metadata">Securing Version Metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="administration.html#backups-and-exports">Backups and Exports</a></li>
<li class="toctree-l3"><a class="reference internal" href="administration.html#database-high-availability">Database High-Availability</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="administration.html#securing-block-data-on-storages">Securing Block Data on Storages</a></li>
<li class="toctree-l2"><a class="reference internal" href="administration.html#monitoring">Monitoring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="administration.html#general-advise">General Advise</a></li>
<li class="toctree-l3"><a class="reference internal" href="administration.html#machine-output">Machine output</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="container.html">Containerized Benji</a><ul>
<li class="toctree-l2"><a class="reference internal" href="container.html#images">Images</a><ul>
<li class="toctree-l3"><a class="reference internal" href="container.html#benji">benji</a></li>
<li class="toctree-l3"><a class="reference internal" href="container.html#benji-k8s">benji-k8s</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="container.html#helm-charts">Helm Charts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="container.html#id1">benji-k8s</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="filter_expressions.html">Filter Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="datalayout.html">Data Layout</a><ul>
<li class="toctree-l2"><a class="reference internal" href="datalayout.html#database-backend">Database Backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="datalayout.html#block-storages">Block Storages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="backy2.html">For Backy² Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="support.html#issue-tracker">Issue Tracker</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#security">Security</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="licenses.html">Licenses</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Benji Backup</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/configuration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuration">
<span id="id1"></span><h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="configuration-file-location">
<h2>Configuration File Location<a class="headerlink" href="#configuration-file-location" title="Permalink to this headline">¶</a></h2>
<p>Benji will by default search the following locations for configuration files:</p>
<ul class="simple">
<li>/etc/benji.yaml</li>
<li>/etc/benji/benji.yaml</li>
<li>~/.benji.yaml</li>
<li>~/benji.yaml</li>
</ul>
<p>If multiple of these files exist, only the first file found is read.</p>
<p>In order to explicitly pass a configuration file, use the <code class="docutils literal notranslate"><span class="pre">-c</span></code> (or
<code class="docutils literal notranslate"><span class="pre">--configfile</span></code>) parameter.</p>
</div>
<div class="section" id="top-level-configuration-directives">
<h2>Top-level configuration directives<a class="headerlink" href="#top-level-configuration-directives" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>key: <strong>configurationVersion</strong></li>
<li>type: string (integer is also accepted)</li>
<li>required</li>
</ul>
<p>Currently this is always <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<ul class="simple">
<li>key: <strong>logFile</strong></li>
<li>type: string</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">null</span></code></li>
</ul>
<p>Benji will by default log INFO, WARNING and ERROR to this file. If you also
need DEBUG information, please start Benji with <code class="docutils literal notranslate"><span class="pre">--log-level</span> <span class="pre">DEBUG</span></code>.
Setting this to null disables logging to a file, this might be useful when
running Benji inside a container.</p>
<ul class="simple">
<li>key: <strong>blockSize</strong></li>
<li>type: integer</li>
<li>unit: bytes</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">4194304</span></code> (4MiB)</li>
</ul>
<p>The block size can be changed on the command line on a version by version
basis, but be aware that this will affect deduplication and increase the
space usage. One possible use case for different block sizes would be backing
up LVM volumes and Ceph images with the same Benji installation. While for Ceph
4MiB is usually the best size, LVM volume might profit from a smaller block size.</p>
<ul class="simple">
<li>key: <strong>hashFunction</strong></li>
<li>type: string</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">BLAKE2b,digest_bits=256</span></code></li>
</ul>
<p>Hash function to use for calculating block checksums. There is normally no reason
to change the default. <strong>Do not change this setting when backups already exist.</strong></p>
<ul class="simple">
<li>key: <strong>processName</strong></li>
<li>type: string</li>
<li>default : <code class="docutils literal notranslate"><span class="pre">benji</span></code></li>
</ul>
<p>This name will be used to identify a specific instance of Benji in the process list
and  can be used to distinguish several parallel installations.</p>
<ul class="simple">
<li>key: <strong>disallowRemoveWhenYounger</strong></li>
<li>type: integer</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">6</span></code></li>
</ul>
<p>This settings disallows removal of backup versions if they are younger than the
specified number of days. Set to 0 to disable, i.e. to be able to delete any
backup version regardless of its age.</p>
<ul class="simple">
<li>key: <strong>databaseEngine</strong></li>
<li>type: string</li>
<li>required</li>
</ul>
<p>See <a class="reference external" href="https://docs.sqlalchemy.org/en/latest/core/engines.html">https://docs.sqlalchemy.org/en/latest/core/engines.html</a> for options.
Only PostgreSQL (dialect psycopg2) and SQLite 3 are tested with during development.</p>
<ul class="simple">
<li>key: <strong>ios</strong></li>
<li>type: list of dictionaries</li>
<li>required</li>
</ul>
<p>List of I/O configurations. Backup sources are accessed via these configurations.
They are also used as a destination during restore operations. See below.</p>
<ul class="simple">
<li>key: <strong>storages</strong></li>
<li>type: list of dictionaries</li>
<li>required</li>
</ul>
<p>List of storage configurations used for storing backup versions. See below.</p>
<ul class="simple">
<li>key: <strong>defaultStorage</strong></li>
<li>type: string</li>
<li>required</li>
</ul>
<p>Default storage for storing backup versions. Reference to a storage name.</p>
<ul class="simple">
<li>key: <strong>transforms</strong></li>
<li>type: list of dictionaries</li>
<li>default: empty list</li>
</ul>
<p>List of data transformation configurations. See below.</p>
<ul class="simple">
<li>key: <strong>nbd</strong></li>
<li>type: dictionary</li>
<li>default: see below</li>
</ul>
<p>Configuration options pertaining to Benji’s NBD server.</p>
</div>
<div class="section" id="list-of-i-o-configurations">
<h2>List of I/O Configurations<a class="headerlink" href="#list-of-i-o-configurations" title="Permalink to this headline">¶</a></h2>
<p>The list of I/O configurations (<strong>ios</strong>) is a list of dictionaries with the
following keys:</p>
<ul class="simple">
<li>key: <strong>name</strong></li>
<li>type: string</li>
<li>default: none</li>
</ul>
<p>This sets the name of this I/O configuration entry. It is used as the
scheme in backup source or restore destination specifications.</p>
<ul class="simple">
<li>key: <strong>module</strong></li>
<li>type: string</li>
<li>default: none</li>
</ul>
<p>Reference to a I/O module name. See below.</p>
<ul class="simple">
<li>key: <strong>configuration</strong></li>
<li>type: list of dictionaries</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">null</span></code></li>
</ul>
<p>Module specific configuration for this I/O configuration entry.</p>
</div>
<div class="section" id="list-of-transform-configurations">
<h2>List of Transform Configurations<a class="headerlink" href="#list-of-transform-configurations" title="Permalink to this headline">¶</a></h2>
<p>The list of transform configuration (<strong>transforms</strong>) is a list of
dictionaries with the following keys:</p>
<ul class="simple">
<li>key: <strong>name</strong></li>
<li>type: string</li>
<li>default: none</li>
</ul>
<p>This sets the name of this transform configuration entry. It is
referenced in the list of <strong>activeTransforms</strong>.</p>
<ul class="simple">
<li>key: <strong>module</strong></li>
<li>type: string</li>
<li>default: none</li>
</ul>
<p>Reference to a transform module name. See below.</p>
<ul class="simple">
<li>key: <strong>configuration</strong></li>
<li>type: list of dictionaries</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">null</span></code></li>
</ul>
<p>Module specific configuration for this transform configuration entry.</p>
</div>
<div class="section" id="list-of-storage-configurations">
<h2>List of Storage Configurations<a class="headerlink" href="#list-of-storage-configurations" title="Permalink to this headline">¶</a></h2>
<p>The list of storage configurations (<strong>storages</strong>) is a list of dictionaries
with the following keys:</p>
<ul class="simple">
<li>key: <strong>name</strong></li>
<li>type: string</li>
<li>default: none</li>
</ul>
<p>This sets the name of this storage configuration entry. It is referenced by
the <strong>defaultStorage</strong> top-level configuration directive or it is specified
on the command line.</p>
<ul class="simple">
<li>key: <strong>module</strong></li>
<li>type: string</li>
<li>default: none</li>
</ul>
<p>Reference to a storage module name. See below.</p>
<ul class="simple">
<li>key: <strong>storageId</strong></li>
<li>type: integer</li>
<li>default: none</li>
</ul>
<p>This sets the internal storage id for this storage configuration.</p>
<ul class="simple">
<li>key: <strong>configuration</strong></li>
<li>type: list of dictionaries</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">null</span></code></li>
</ul>
<p>Module specific configuration for this storage configuration entry.</p>
</div>
<div class="section" id="i-o-modules">
<h2>I/O Modules<a class="headerlink" href="#i-o-modules" title="Permalink to this headline">¶</a></h2>
<p>All currently available I/O modules support the following configuration
options:</p>
<ul class="simple">
<li>name: <strong>simultaneousReads</strong></li>
<li>type: integer</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></li>
</ul>
<p>Number of reader threads when reading from a backup source. Also
affects the internal read queue length. It is highly recommended to
increase this number to increase this number to get better concurrency
and performance.</p>
<ul class="simple">
<li>name: <strong>simultaneousWrites</strong></li>
<li>type: integer</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></li>
</ul>
<p>Number of writer threads when restoring a version. Also affects the internal write queue length. It is highly
recommended to increase this number to increase this number to get better concurrency and performance.</p>
<div class="section" id="i-o-module-file">
<h3>I/O Module file<a class="headerlink" href="#i-o-module-file" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">file</span></code> I/O module currently supports no additional configuration
directives.</p>
</div>
<div class="section" id="i-o-module-rbd">
<h3>I/O Module rbd<a class="headerlink" href="#i-o-module-rbd" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">rbd</span></code> I/O module supports the following additional configuration
options:</p>
<ul class="simple">
<li>name: <strong>cephConfigFile</strong></li>
<li>type: string</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">/etc/ceph/ceph.conf</span></code></li>
</ul>
<p>Sets the path to the Ceph configuration file used by this I/O configuration.</p>
<ul class="simple">
<li>name: <strong>clientIdentifier</strong></li>
<li>type: string</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">admin</span></code></li>
</ul>
<p>Sets the name of the client identifier used by this I/O configuration to
access the Ceph RBD service.</p>
<ul class="simple">
<li>name: <strong>newImageFeatures</strong></li>
<li>type: list of strings</li>
<li>default: none, required</li>
</ul>
<p>Valid values for this list are extracted from the installed Ceph RBD
libraries. For recent version of Ceph this list of possible image
features applies: <code class="docutils literal notranslate"><span class="pre">RBD_FEATURE_LAYERING</span></code>, <code class="docutils literal notranslate"><span class="pre">RBD_FEATURE_EXCLUSIVE_LOCK</span></code>,
<code class="docutils literal notranslate"><span class="pre">RBD_FEATURE_STRIPINGV2</span></code>, <code class="docutils literal notranslate"><span class="pre">RBD_FEATURE_OBJECT_MAP</span></code>,
<code class="docutils literal notranslate"><span class="pre">RBD_FEATURE_FAST_DIFF</span></code>, <code class="docutils literal notranslate"><span class="pre">RBD_FEATURE_DEEP_FLATTEN</span></code>.</p>
</div>
</div>
<div class="section" id="transform-modules">
<h2>Transform Modules<a class="headerlink" href="#transform-modules" title="Permalink to this headline">¶</a></h2>
<p>The name given to a transform configuration is saved together with the data
object to the storage. This means that you must be careful when changing the
configuration after a transform has been used by a storage. For example
you can’t just change the encryption key because you will lose access to
all data objects already encrypted with the old key. But you can create
a new encryption configuration with a new name and use it instead in
the list of <strong>activeTransforms</strong> of your storage. All newly create data
objects will then use this new transform. Old objects will still be
encrypted with the old key but they can still be decrypted as long as
the old encryption configuration is available under the old name. Key
rollover is not yet implemented.</p>
<p>It is harmless to change the compression level. But this change will only
affect newly create data objects.</p>
<div class="section" id="transform-module-zstd">
<h3>Transform Module zstd<a class="headerlink" href="#transform-module-zstd" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">zstd</span></code> module supports the following configuration
options:</p>
<ul class="simple">
<li>name: <strong>level</strong></li>
<li>type: integer</li>
<li>default: none, required</li>
</ul>
<p>The compression level used for compressing blocks of data.</p>
<ul class="simple">
<li>name: <strong>dictDataFile</strong></li>
<li>type: string</li>
<li>default: none</li>
</ul>
<p>Sets the path to a zstandard dictionary. This option has limited value in the
context of Benji and shouldn’t be set.</p>
</div>
<div class="section" id="transform-module-aes-256-gcm">
<h3>Transform Module aes_256_gcm<a class="headerlink" href="#transform-module-aes-256-gcm" title="Permalink to this headline">¶</a></h3>
<p>This module encrypts each data block with its own randomly generated key
by using AES-256 in GCM mode. The random key is then encrypted with
a master key by using the key wrapping algorithm specified in RFC 3394
and then saved beside the data block.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">aes_256_gcm</span></code> module supports the following configuration
options:</p>
<ul class="simple">
<li>name: <strong>kdfSalt</strong></li>
<li>type: binary string encoded with BASE64</li>
<li>default: none</li>
</ul>
<p>Sets the salt for the key derivation function.</p>
<ul class="simple">
<li>name: <strong>kdfIterations</strong></li>
<li>type: binary string encoded with BASE64</li>
<li>default: none</li>
</ul>
<p>Sets the number of iterations for the key derivation function.</p>
<ul class="simple">
<li>name: <strong>password</strong></li>
<li>type: binary string encoded with BASE64</li>
<li>default: none</li>
</ul>
<p>Sets the password from which the master key is generated.</p>
<ul class="simple">
<li>name: <strong>masterKey</strong></li>
<li>type: binary string with a length of 32 bytes encoded with BASE64</li>
<li>default: none</li>
</ul>
<p>Sets the master key used for encrypting the envelope keys. This key should
have a high entropy. In most cases it is safer and easier to derive
the key from a <strong>password</strong>.</p>
<p>The <strong>masterKey</strong> configuration directive is mutually exclusive
to the other three directives.</p>
<p>When the <strong>masterKey</strong> directive is not set the master key is derived from
the other three configuration directives by using PBKDF2 with SHA-512.</p>
<p>Regarding kdfSalt and kdfIterations: It is highly recommended to generate
your own random salt and chose your own number of iterations. Don’t change
the salt and iteration count after writing encrypted data objects,  they
cannot be decrypted anymore.</p>
</div>
</div>
<div class="section" id="storage-modules">
<h2>Storage Modules<a class="headerlink" href="#storage-modules" title="Permalink to this headline">¶</a></h2>
<p>All storage modules support the following configuration directives:</p>
<ul class="simple">
<li>name: <strong>simultaneousReads</strong></li>
<li>type: integer</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></li>
</ul>
<p>Number of reader threads when reading from a storage. Also affects the internal read queue length. It is highly
recommended to increase this number to increase this number to get better concurrency and performance.</p>
<ul class="simple">
<li>name: <strong>simultaneousWrites</strong></li>
<li>type: integer</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></li>
</ul>
<p>Number of writer threads when writing to a storage. Also affects the internal write queue length. It is highly
recommended to increase this number to increase this number to get better concurrency and performance.</p>
<ul class="simple">
<li>name: <strong>simultaneousRemovals</strong></li>
<li>type: integer</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></li>
</ul>
<p>Number of removal threads when removing blocks from a storage. Also affects the internal queue length. It is highly
recommended to increase this number to increase this number to get better concurrency and performance.</p>
<ul class="simple">
<li>name: <strong>bandwidthRead</strong></li>
<li>type: integer</li>
<li>unit: bytes per second</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">0</span></code></li>
</ul>
<p>This limits the number of bytes read from the storage by second using a token
bucket algorithm. A value of <code class="docutils literal notranslate"><span class="pre">0</span></code> disables this feature.</p>
<ul class="simple">
<li>name: <strong>bandwidthWrite</strong></li>
<li>type: integer</li>
<li>unit: bytes per second</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">0</span></code></li>
</ul>
<p>This limits the number of bytes written to the storage by second using a token
bucket algorithm.  A value of <code class="docutils literal notranslate"><span class="pre">0</span></code> disables this feature.</p>
<ul class="simple">
<li>name: <strong>activeTransforms</strong></li>
<li>type: list of strings</li>
<li>default: empty list</li>
</ul>
<p>Sets a list of transform which are applied to each data object before it is
written to the storage. The transformations are performed in order. In
forward direction when writing data and in reverse direction when reading.</p>
<ul class="simple">
<li>name: <strong>consistencyCheckWrites</strong></li>
<li>type: bool</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">false</span></code></li>
</ul>
<p>When this option is set to <code class="docutils literal notranslate"><span class="pre">true</span></code> then each write to the storage is followed
by a read checking the data integrity of the written object data and metadata.
This is intended to by used when developing new storage modules and should be
disabled during normal use as it reduces the performance significantly.</p>
<div class="section" id="hmac">
<h3>HMAC<a class="headerlink" href="#hmac" title="Permalink to this headline">¶</a></h3>
<p>The metadata for each data object in a storage is written to a separate object
accompanying it. This metadata as whole is not encrypted. To protect against
metadata corruption or malicious manipulation an object’s metadata can be
protected by a HMAC (Hash-based Message Authentication Code). Benji’s
implementation conforms to RFC 2104 and uses SHA-256 as the hash algorithm.</p>
<ul class="simple">
<li>name: <strong>hmac</strong></li>
<li>type: dictionary</li>
<li>default: none</li>
</ul>
<p>The <strong>hmac</strong> dictionary supports the following keys:</p>
<ul class="simple">
<li>name: <strong>kdfSalt</strong></li>
<li>type: binary string encoded with BASE64</li>
<li>default: none</li>
</ul>
<p>Set ths salt for the key derivation function.</p>
<ul class="simple">
<li>name: <strong>kdfIterations</strong></li>
<li>type: integer</li>
<li>default: none</li>
</ul>
<p>Sets the number of iterations for the key derivation function.</p>
<ul class="simple">
<li>name: <strong>password</strong></li>
<li>type: string</li>
<li>default: none</li>
</ul>
<p>Sets the password from which the key is generated.</p>
<ul class="simple">
<li>name: <strong>key</strong></li>
<li>type: binary string encoded with BASE64</li>
<li>default: none</li>
</ul>
<p>Sets the key used for seeding the hash function. In most cases it is safer and
easier to derive the key from a <strong>password</strong>.</p>
<p>The <strong>key</strong> configuration directive is mutually exclusive to the other
three directives.</p>
<p>When the <strong>key</strong> directive is not set the key is derived from the other
three configuration directives by using PBKDF2 with SHA-512.</p>
</div>
<div class="section" id="read-cache">
<h3>Read Cache<a class="headerlink" href="#read-cache" title="Permalink to this headline">¶</a></h3>
<p>Benji supports a read cache for all storage modules. The read cache can be
be beneficial when frequently restoring images that are mostly identical.</p>
<ul class="simple">
<li>name: <strong>readCache</strong></li>
<li>type: dictionary</li>
<li>default: none</li>
</ul>
<p>The <strong>readCache</strong> dictionary supports the following keys:</p>
<ul class="simple">
<li>name: <strong>directory</strong></li>
<li>type: string</li>
<li>default: none</li>
</ul>
<p>Sets the directory used by the cache.</p>
<ul class="simple">
<li>name: <strong>maximumSize</strong></li>
<li>type: integer</li>
<li>unit: bytes</li>
<li>default: none</li>
</ul>
<p>Maximum size of the cache in bytes.</p>
<ul class="simple">
<li>name: <strong>shards</strong></li>
<li>type: integer</li>
<li>default: none</li>
</ul>
<p>Sets the number of cache shards. Needs to be scaled together with
<strong>simultaneousReads</strong>.</p>
</div>
<div class="section" id="storage-module-file">
<h3>Storage Module file<a class="headerlink" href="#storage-module-file" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">file</span></code> storage module supports the following configuration options:</p>
<ul class="simple">
<li>name: <strong>path</strong></li>
<li>type: string</li>
<li>required</li>
</ul>
<p>Sets the path to a directory where backup version data is stored.</p>
</div>
<div class="section" id="storage-module-s3">
<h3>Storage Module s3<a class="headerlink" href="#storage-module-s3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>name: <strong>awsAccessKeyId</strong></li>
<li>type: string</li>
<li>one of <strong>awsAccessKeyId</strong> or <strong>awsAccessKeyIdFile</strong> required</li>
</ul>
<p>Sets the access key id. This option and the <strong>awsAccessKeyIdFile</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li>name: <strong>awsAccessKeyIdFile</strong></li>
<li>type: string</li>
<li>one of <strong>awsAccessKeyId</strong> or <strong>awsAccessKeyIdFile</strong> required</li>
</ul>
<p>Sets the access key id from a file. This option and the <strong>awsAccessKeyId</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li>name: <strong>awsSecretAccessKey</strong></li>
<li>type: string</li>
<li>one of <strong>awsSecretAccessKey</strong> or <strong>awsSecretAccessKeyFile</strong> required</li>
</ul>
<p>Set the access key. This option and the <strong>awsSecretAccessKeyFile</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li>name: <strong>awsSecretAccessKeyFile</strong></li>
<li>type: string</li>
<li>one of <strong>awsSecretAccessKey</strong> or <strong>awsSecretAccessKeyFile</strong> required</li>
</ul>
<p>Sets the access key from a file.This option and the <strong>awsSecretAccessKey</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li>name: <strong>bucketName</strong></li>
<li>type: string</li>
<li>required</li>
</ul>
<p>Sets the bucket name.</p>
<ul class="simple">
<li>name: <strong>regionName</strong></li>
<li>type: string</li>
<li>default: from <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library, ignored if <strong>endpointUrl</strong> is specified</li>
</ul>
<p>Sets the region of the bucket.</p>
<ul class="simple">
<li>name: <strong>useSsl</strong></li>
<li>type: bool</li>
<li>default: from <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library, ignored if <strong>endpointUrl</strong> is specified</li>
</ul>
<p>If not set, the default of the underlying <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library is used.
When this option is set to <code class="docutils literal notranslate"><span class="pre">true</span></code> then TLS is used to connect to
the S3 API endpoint. When it is set to <code class="docutils literal notranslate"><span class="pre">false</span></code> HTTP is used.</p>
<ul class="simple">
<li>name: <strong>endpointUrl</strong></li>
<li>type: string</li>
<li>default: none</li>
</ul>
<p>If not set, the default of the underlying <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library is used.
This option sets the S3 API endpoint to use in URL format. If it is
specified other options like <strong>regionName</strong> and <strong>useSsl</strong> are ignored
by the underlying <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library. This needs to be set to
<code class="docutils literal notranslate"><span class="pre">https://storage.googleapis.com/</span></code> when connecting to a Google Storage
bucket.</p>
<ul class="simple">
<li>name: <strong>addressingStyle</strong></li>
<li>type: string</li>
<li>default: none</li>
</ul>
<p>If not set, the default of the underlying <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library is used.
Valid values are <code class="docutils literal notranslate"><span class="pre">path</span></code> and <code class="docutils literal notranslate"><span class="pre">host</span></code>. This needs to be set to <code class="docutils literal notranslate"><span class="pre">path</span></code>
when connecting to a Google Storage bucket.</p>
<ul class="simple">
<li>name: <strong>signatureVersion</strong></li>
<li>type: string</li>
<li>default: none</li>
</ul>
<p>If not set, the default of the underlying <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library is used. Valid
values are <code class="docutils literal notranslate"><span class="pre">s3</span></code> for version 2 signatures and  <code class="docutils literal notranslate"><span class="pre">s3v4</span></code> for version 4
signatures.</p>
<ul class="simple">
<li>name: <strong>disableEncodingType</strong></li>
<li>type: bool</li>
<li>default: False</li>
</ul>
<p>Some S3 compatible endpoints generate errors when an encoding type is set
during some operations. Enabling this setting prevents this by not sending
this HTTP header. This needs to be set to <code class="docutils literal notranslate"><span class="pre">true</span></code> when connecting
to a Google Storage bucket.</p>
</div>
<div class="section" id="storage-module-b2">
<h3>Storage Module b2<a class="headerlink" href="#storage-module-b2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>name: <strong>accountId</strong></li>
<li>type: string</li>
<li>one of <strong>accountId</strong> or <strong>accountIdFile</strong> required</li>
</ul>
<p>Set the account id. This option and the <strong>accountIdFile</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li>name: <strong>accountIdFile</strong></li>
<li>type: string</li>
<li>one of <strong>accountId</strong> or <strong>accountIdFile</strong> required</li>
</ul>
<p>Sets the account id from a file. This option and the <strong>accountId</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li>name: <strong>applicationKey</strong></li>
<li>type: string</li>
<li>one of <strong>applicationKey</strong> or <strong>applicationKeyFile</strong> required</li>
</ul>
<p>Sets the application key. This option and the <strong>applicationKeyFile</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li>name: <strong>applicationKeyFile</strong></li>
<li>type: string</li>
<li>one of <strong>applicationKey</strong> or <strong>applicationKeyFile</strong> required</li>
</ul>
<p>Sets the application key from a file. This option and the <strong>applicationKey</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li>name: <strong>bucketName</strong></li>
<li>type: string</li>
<li>required</li>
</ul>
<p>Sets the bucket name.</p>
<ul class="simple">
<li>name: <strong>uploadAttempts</strong></li>
<li>type: integer</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">5</span></code></li>
</ul>
<p>Sets the number of upload attempts made by the underlying <code class="docutils literal notranslate"><span class="pre">b2</span></code> library.</p>
<ul class="simple">
<li>name: <strong>writeObjectAttempts</strong></li>
<li>type: integer</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">3</span></code></li>
</ul>
<p>Sometimes the b2 API shows transient errors during object writes. Benji will
retry writes this number of times.</p>
<ul class="simple">
<li>name: <strong>readObjectAttempts</strong></li>
<li>type: integer</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">3</span></code></li>
</ul>
<p>Sometimes the b2 API shows transient errors during object reads. Benji will
retry reads this number of times.</p>
</div>
</div>
<div class="section" id="nbd">
<h2>NBD<a class="headerlink" href="#nbd" title="Permalink to this headline">¶</a></h2>
<p>Configuration options pertaining to Benji’s NBD server are located under
the top-level key <strong>nbd</strong>:</p>
<p>The only configuration option currently present in the <strong>nbd</strong> dictionary
is:</p>
<ul class="simple">
<li>name: <strong>directory</strong></li>
<li>type: string</li>
<li>default: <code class="docutils literal notranslate"><span class="pre">/tmp</span></code></li>
</ul>
</div>
<div class="section" id="multiple-instance-installations">
<h2>Multiple Instance Installations<a class="headerlink" href="#multiple-instance-installations" title="Permalink to this headline">¶</a></h2>
<p>You can run Benji multiple times on different machines or in different
containers simultaneously. The configurations will have to match.
This is the responsibility of the user and isn’t checked by Benji!  Be
careful to shutdown all instances before making configuration changes that
could affect other instances (like adding an encryption key).</p>
<p>Multiple instances open up the possibility to scale-out Benji for
performance reasons, to put instances where the backup source data is or to
have a dedicated instance for restores for example.</p>
<p>Locking between different instances is done via the database backend.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="backup.html" class="btn btn-neutral float-right" title="Backup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral" title="Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2019, Lars Fenneberg, Daniel Kraft

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/asciinema/asciinema-player.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 


</body>
</html>