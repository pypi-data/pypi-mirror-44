#!/usr/bin/env python3
import os
import sys
import time
abs_path = os.path.abspath(sys.argv[0])
basedir = os.path.dirname(os.path.dirname(abs_path)) 

if 'lib' not in basedir:
    sys.path.insert(0,basedir)
from dbma import config

# 权限验证，一定要用 root 用户来运行 dbm-agent
if os.geteuid() != 0 or os.getegid() != 0:
    print('error !!! you must use root user execute this program .')
    sys.exit(1)

def main():
    """
    dbm-agent 入口点函数
    """
    args = config.get_config_from_cmd()
    if args.action == 'init':
        # 初始化指令
        _,s = str(time.time()).split('.')  # 产生一个随机的字符串
        os.makedirs(f'/tmp/{s}/logs') # 创建临时目录
        os.chdir(f'/tmp/{s}')
        from dbma import init
        init.init_dbma(args)
    elif args.action == 'start':
        # 启动指令
        pass

if __name__ == "__main__":
    main()

        

        



