(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{107:function(e,t,n){e.exports=n(240)},112:function(e,t,n){},240:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(22),i=n.n(s),c=(n(112),n(2)),o=n.n(c),l=n(3),u=n(6),p=n(7),d=n(8),h=n(5),m=n(9),f=n(243),v=n(244),g=n(31),b=n(95),y=n(242),E=function(e){var t=e.component,n=e.render,a=e.authed,s=e.to,i=void 0===s?"/login":s,c=Object(g.a)(e,["component","render","authed","to"]);return r.a.createElement(b.a,Object.assign({},c,{render:function(e){return!0===a?t?r.a.createElement(t,e):n():r.a.createElement(y.a,{to:{pathname:i}})}}))},O=function(e){return r.a.createElement("div",Object.assign({},e,{className:"spinner ".concat(e.className||"")}),r.a.createElement("svg",{viewBox:"25 25 50 50"},r.a.createElement("circle",{cx:"50",cy:"50",r:"20",fill:"none",strokeWidth:"2",strokeMiterlimit:"10"})))},k="/_matrix/maubot/v1";function w(){return{"Content-Type":arguments.length>0&&void 0!==arguments[0]?arguments[0]:"application/json",Authorization:"Bearer ".concat(localStorage.accessToken)}}function N(e,t){return j.apply(this,arguments)}function j(){return(j=Object(l.a)(o.a.mark(function e(t,n){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(k,"/").concat(t,"/").concat(n),{headers:w(),method:"DELETE"});case 2:if(204!==(a=e.sent).status){e.next=5;break}return e.abrupt("return",{success:!0});case 5:return e.next=7,a.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function x(e,t){return S.apply(this,arguments)}function S(){return(S=Object(l.a)(o.a.mark(function e(t,n){var a,r,s=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>2&&void 0!==s[2]?s[2]:void 0,e.next=3,fetch("".concat(k,"/").concat(t,"/").concat(a||n.id),{headers:w(),body:JSON.stringify(n),method:"PUT"});case 3:return r=e.sent,e.next=6,r.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function C(e){return L.apply(this,arguments)}function L(){return(L=Object(l.a)(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(k).concat(t),{headers:w()});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function P(){return(P=Object(l.a)(o.a.mark(function e(t,n){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(k,"/auth/login"),{method:"POST",body:JSON.stringify({username:t,password:n})});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function T(){return(T=Object(l.a)(o.a.mark(function e(){var t,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(k,"/auth/ping"),{method:"POST",headers:w()});case 2:return t=e.sent,e.next=5,t.json();case 5:if(!(n=e.sent).username){e.next=10;break}return e.abrupt("return",n.username);case 10:if("auth_token_missing"!==n.errcode&&"auth_token_invalid"!==n.errcode){e.next=12;break}return e.abrupt("return",null);case 12:throw n;case 13:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function _(){return(_=Object(l.a)(o.a.mark(function e(){var t,n,a,r,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="https:"===window.location.protocol?"wss:":"ws:",n="".concat(t,"//").concat(window.location.host).concat(k,"/logs"),a={socket:null,connected:!1,authenticated:!1,onLog:function(e){},onHistory:function(e){},fails:-1},r=function(){a.socket.send(localStorage.accessToken),a.connected=!0},s=function(e){var t=JSON.parse(e.data);void 0!==t.auth_success?t.auth_success?(console.info("Websocket connection authentication successful"),a.authenticated=!0,a.fails=-1):console.info("Websocket connection authentication failed"):t.history?a.onHistory(t.history):a.onLog(t)},function e(t){t&&(4e3===t.code?console.error("Websocket connection failed: access token invalid or not provided"):1012===t.code&&console.info("Websocket connection closed: server is restarting")),a.connected=!1,a.socket=null,a.fails++;setTimeout(function(){a.socket=new WebSocket(n),a.socket.onopen=r,a.socket.onmessage=s,a.socket.onclose=e},Math.min(5*a.fails*1e3,3e4))}(),e.abrupt("return",a);case 8:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var A=void 0;function R(){return(R=Object(l.a)(o.a.mark(function e(t,n){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(k,"/debug/open"),{headers:w(),body:JSON.stringify({path:t,line:n}),method:"POST"});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function F(){return(F=Object(l.a)(o.a.mark(function e(t,n){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=6;break}return e.next=3,fetch("".concat(k,"/plugin/").concat(n),{headers:w("application/zip"),body:t,method:"PUT"});case 3:a=e.sent,e.next=9;break;case 6:return e.next=8,fetch("".concat(k,"/plugins/upload"),{headers:w("application/zip"),body:t,method:"POST"});case 8:a=e.sent;case 9:return e.next=11,a.json();case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function I(){return(I=Object(l.a)(o.a.mark(function e(t,n,a){var r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(k,"/proxy/").concat(t,"/_matrix/media/r0/upload"),{headers:w(a),body:n,method:"POST"});case 2:return r=e.sent,e.next=5,r.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var V={BASE_PATH:k,login:function(e,t){return P.apply(this,arguments)},ping:function(){return T.apply(this,arguments)},openLogSocket:function(){return _.apply(this,arguments)},debugOpenFile:function(e,t){return R.apply(this,arguments)},debugOpenFileEnabled:function(){return A},updateDebugOpenFileEnabled:function(){var e=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C("/debug/open");case 2:t=e.sent,A=t.enabled||!1;case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getInstances:function(){return C("/instances")},getInstance:function(e){return C("/instance/".concat(e))},putInstance:function(e,t){return x("instance",e,t)},deleteInstance:function(e){return N("instance",e)},getPlugins:function(){return C("/plugins")},getPlugin:function(e){return C("/plugin/".concat(e))},uploadPlugin:function(e,t){return F.apply(this,arguments)},deletePlugin:function(e){return N("plugin",e)},getClients:function(){return C("/clients")},getClient:function(e){return C("/clients/".concat(e))},uploadAvatar:function(e,t,n){return I.apply(this,arguments)},getAvatarURL:function(e){var t=e.id,n=e.avatar_url;return(n=n||"").startsWith("mxc://")&&(n=n.substr("mxc://".length)),"".concat(k,"/proxy/").concat(t,"/_matrix/media/r0/download/").concat(n,"?access_token=").concat(localStorage.accessToken)},putClient:function(e){return x("client",e)},deleteClient:function(e){return N("client",e)}},W=n(23),B=n(104),D=n(35),M=n(100),H=n(245);function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var z=r.a.createElement("path",{fill:"#000000",d:"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"});const J=e=>r.a.createElement("svg",U({xmlnsXlink:"http://www.w3.org/1999/xlink",version:1.1,width:24,height:24,viewBox:"0 0 24 24"},e),z);n.p;var K=n(105),G=n(241),Z=n(96),q=n.n(Z);n(125),n(126);function X(){return(X=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var Y=r.a.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),Q=r.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"});const $=e=>r.a.createElement("svg",X({width:24,height:24,viewBox:"0 0 24 24"},e),Y,Q);n.p;var ee=n(106),te=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).toggle=function(){n.props.onToggle?n.props.onToggle(!n.state.active):n.setState({active:!n.state.active})},n.toggleKeyboard=function(e){return(" "===e.key||"Enter"===e.key)&&n.toggle()},n.state={active:e.active},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({active:e.active})}},{key:"render",value:function(){return r.a.createElement("div",{className:"switch","data-active":this.state.active,onClick:this.toggle,tabIndex:"0",onKeyPress:this.toggleKeyboard,id:this.props.id},r.a.createElement("div",{className:"box"},r.a.createElement("span",{className:"text"},r.a.createElement("span",{className:"on"},this.props.onText||"On"),r.a.createElement("span",{className:"off"},this.props.offText||"Off"))))}}]),t}(a.Component),ne=function(e){var t=e.children,n=e.wrapperClass;return n?r.a.createElement("div",{className:n},r.a.createElement("div",{className:"preference-table"},t)):r.a.createElement("div",{className:"preference-table"},t)},ae=function(e){var t=e.name,n=e.fullWidth,a=void 0!==n&&n,s=e.labelFor,i=void 0===s?void 0:s,c=e.changed,o=void 0!==c&&c,l=e.children;return r.a.createElement("div",{className:"entry ".concat(a?"full-width":""," ").concat(o?"changed":"")},r.a.createElement("label",{htmlFor:i},t),r.a.createElement("div",{className:"value"},l))},re=function(e){var t=e.rowName,n=e.value,a=e.origValue,s=e.fullWidth,i=void 0!==s&&s,c=Object(g.a)(e,["rowName","value","origValue","fullWidth"]);return r.a.createElement(ae,{name:t,fullWidth:i,labelFor:t,changed:void 0!==a&&n!==a},r.a.createElement("input",Object.assign({},c,{value:n,id:t})))},se=function(e){var t=e.rowName,n=e.active,a=e.origActive,s=e.fullWidth,i=void 0!==s&&s,c=Object(g.a)(e,["rowName","active","origActive","fullWidth"]);return r.a.createElement(ae,{name:t,fullWidth:i,labelFor:t,changed:void 0!==a&&n!==a},r.a.createElement(te,Object.assign({},c,{active:n,id:t})))},ie=function(e){var t=e.rowName,n=e.value,a=e.origValue,s=e.fullWidth,i=void 0!==s&&s,c=Object(g.a)(e,["rowName","value","origValue","fullWidth"]);return r.a.createElement(ae,{name:t,fullWidth:i,labelFor:t,changed:void 0!==a&&n.id!==a},r.a.createElement(ee.a,Object.assign({className:"select"},c,{id:t,value:n})))},ce=ne,oe=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).delete=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.confirm("Are you sure you want to delete ".concat(n.state.id,"?"))){e.next=2;break}return e.abrupt("return");case 2:return n.setState({deleting:!0}),e.next=5,n.deleteFunc(n.state.id);case 5:(t=e.sent).success?(n.props.history.push("/"),n.props.onDelete()):n.setState({deleting:!1,error:t.error});case 7:case"end":return e.stop()}},e,this)})),n.inputChange=function(e){e.target.name&&n.setState(Object(W.a)({},e.target.name,e.target.value))},n.renderInstances=function(){return!n.isNew&&r.a.createElement("div",{className:"instances"},r.a.createElement("h3",null,n.hasInstances?"Instances":"No instances :("),n.state.instances.map(function(e){return r.a.createElement(M.a,{className:"instance",key:e.id,to:"/instance/".concat(e.id)},e.id)}))},n.renderLogButton=function(e){return!n.isNew&&r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{className:"open-log",onClick:function(){return n.props.openLog(e)}},"View logs"))},n.state=Object.assign(n.initialState,e.entry),n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=Object.assign(this.initialState,e.entry),n=!0,a=!1,r=void 0;try{for(var s,i=this.entryKeys[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var c=s.value;this.props.entry[c]===e.entry[c]&&(t[c]=this.state[c])}}catch(o){a=!0,r=o}finally{try{n||null==i.return||i.return()}finally{if(a)throw r}}this.setState(t)}},{key:"readFile",value:function(){var e=Object(l.a)(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var a=new FileReader;a.readAsArrayBuffer(t),a.onload=function(t){return e(t.target.result)},a.onerror=function(e){return n(e)}}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"entryKeys",get:function(){return[]}},{key:"initialState",get:function(){return{}}},{key:"hasInstances",get:function(){return this.state.instances&&this.state.instances.length>0}},{key:"isNew",get:function(){return!this.props.entry.id}}]),t}(a.Component),le=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).clientSelectEntry=function(e){return e&&{id:e.id,value:e.id,label:r.a.createElement("div",{className:"select-client"},r.a.createElement("img",{className:"avatar",src:V.getAvatarURL(e),alt:""}),r.a.createElement("span",{className:"displayname"},e.displayname||e.id))}},n.save=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({saving:!0}),e.next=3,V.putInstance(n.instanceInState,n.props.entry?n.props.entry.id:void 0);case 3:(t=e.sent).id?(n.isNew?n.props.history.push("/instance/".concat(t.id)):(t.id!==n.props.entry.id&&n.props.history.replace("/instance/".concat(t.id)),n.setState({saving:!1,error:""})),n.props.onChange(t)):n.setState({saving:!1,error:t.error});case 5:case"end":return e.stop()}},e,this)})),n.deleteFunc=V.deleteInstance,n.updateClientOptions(),n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentWillReceiveProps",value:function(e){Object(K.a)(Object(h.a)(t.prototype),"componentWillReceiveProps",this).call(this,e),this.updateClientOptions()}},{key:"updateClientOptions",value:function(){this.clientOptions=Object.values(this.props.ctx.clients).map(this.clientSelectEntry)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"instance"},r.a.createElement(ce,null,r.a.createElement(re,{rowName:"ID",type:"text",name:"id",value:this.state.id,placeholder:"fancybotinstance",onChange:this.inputChange,disabled:!this.isNew,fullWidth:!0,className:"id"}),r.a.createElement(se,{rowName:"Enabled",active:this.state.enabled,origActive:this.props.entry.enabled,onToggle:function(t){return e.setState({enabled:t})}}),r.a.createElement(se,{rowName:"Running",active:this.state.started,origActive:this.props.entry.started,onToggle:function(t){return e.setState({started:t})}}),r.a.createElement(ie,{rowName:"Primary user",options:this.clientOptions,isSearchable:!1,value:this.selectedClientEntry,origValue:this.props.entry.primary_user,onChange:function(t){var n=t.id;return e.setState({primary_user:n})}}),r.a.createElement(ie,{rowName:"Type",options:this.typeOptions,isSearchable:!1,value:this.selectedPluginEntry,origValue:this.props.entry.type,onChange:function(t){var n=t.id;return e.setState({type:n})}})),!this.isNew&&r.a.createElement(q.a,{mode:"yaml",theme:"github",onChange:function(t){return e.setState({config:t})},name:"config",value:this.state.config,editorProps:{fontSize:"10pt",$blockScrolling:!0}}),r.a.createElement("div",{className:"buttons"},!this.isNew&&r.a.createElement("button",{className:"delete",onClick:this.delete,disabled:this.loading},this.state.deleting?r.a.createElement(O,null):"Delete"),r.a.createElement("button",{className:"save ".concat(this.isValid?"":"disabled-bg"),onClick:this.save,disabled:this.loading||!this.isValid},this.state.saving?r.a.createElement(O,null):this.isNew?"Create":"Save")),this.renderLogButton("instance.".concat(this.state.id)),r.a.createElement("div",{className:"error"},this.state.error))}},{key:"entryKeys",get:function(){return["id","primary_user","enabled","started","type","config"]}},{key:"initialState",get:function(){return{id:"",primary_user:"",enabled:!0,started:!0,type:"",config:"",saving:!1,deleting:!1,error:""}}},{key:"instanceInState",get:function(){var e=Object.assign({},this.state);return delete e.saving,delete e.deleting,delete e.error,e}},{key:"selectedClientEntry",get:function(){return this.state.primary_user?this.clientSelectEntry(this.props.ctx.clients[this.state.primary_user]):{}}},{key:"selectedPluginEntry",get:function(){return{id:this.state.type,value:this.state.type,label:this.state.type}}},{key:"typeOptions",get:function(){return Object.values(this.props.ctx.plugins).map(function(e){return e&&{id:e.id,value:e.id,label:e.id}})}},{key:"loading",get:function(){return this.state.deleting||this.state.saving}},{key:"isValid",get:function(){return this.state.id&&this.state.primary_user&&this.state.type}}]),t}(oe);le.ListEntry=function(e){var t=e.entry;return r.a.createElement(G.a,{className:"instance entry",to:"/instance/".concat(t.id)},r.a.createElement("span",{className:"id"},t.id),r.a.createElement($,null))};var ue=Object(H.a)(le);function pe(){return(pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var de=r.a.createElement("path",{fill:"#000000",d:"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z"});const he=e=>r.a.createElement("svg",pe({xmlnsXlink:"http://www.w3.org/1999/xlink",version:1.1,width:24,height:24,viewBox:"0 0 24 24"},e),de);n.p;var me=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).avatarUpload=function(){var e=Object(l.a)(o.a.mark(function e(t){var a,r,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.target.files[0],n.setState({uploadingAvatar:!0}),e.next=4,n.readFile(a);case 4:return r=e.sent,e.next=7,V.uploadAvatar(n.state.id,r,a.type);case 7:s=e.sent,n.setState({uploadingAvatar:!1,avatar_url:s.content_uri});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.save=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({saving:!0}),e.next=3,V.putClient(n.clientInState);case 3:(t=e.sent).id?(n.isNew?n.props.history.push("/client/".concat(t.id)):n.setState({saving:!1,error:""}),n.props.onChange(t)):n.setState({saving:!1,error:t.error});case 5:case"end":return e.stop()}},e,this)})),n.startOrStop=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({startingOrStopping:!0}),e.next=3,V.putClient({id:n.props.entry.id,started:!n.props.entry.started});case 3:(t=e.sent).id?(n.props.onChange(t),n.setState({startingOrStopping:!1,error:""})):n.setState({startingOrStopping:!1,error:t.error});case 5:case"end":return e.stop()}},e,this)})),n.renderSidebar=function(){return!n.isNew&&r.a.createElement("div",{className:"sidebar"},r.a.createElement("div",{className:"avatar-container ".concat(n.state.avatar_url?"":"no-avatar","\n                        ").concat(n.state.uploadingAvatar?"uploading":"")},r.a.createElement("img",{className:"avatar",src:V.getAvatarURL(n.state),alt:"Avatar"}),r.a.createElement(he,{className:"upload"}),r.a.createElement("input",{className:"file-selector",type:"file",accept:"image/png, image/jpeg",onChange:n.avatarUpload,disabled:n.state.uploadingAvatar,onDragEnter:function(e){return e.target.parentElement.classList.add("drag")},onDragLeave:function(e){return e.target.parentElement.classList.remove("drag")}}),n.state.uploadingAvatar&&r.a.createElement(O,null)),r.a.createElement("div",{className:"started-container"},r.a.createElement("span",{className:"started ".concat(n.props.entry.started,"\n                        ").concat(n.props.entry.enabled?"":"disabled")}),r.a.createElement("span",{className:"text"},n.props.entry.started?"Started":n.props.entry.enabled?"Stopped":"Disabled")),(n.props.entry.started||n.props.entry.enabled)&&r.a.createElement("button",{className:"save",onClick:n.startOrStop,disabled:n.loading},n.state.startingOrStopping?r.a.createElement(O,null):n.props.entry.started?"Stop":"Start"))},n.renderPreferences=function(){return r.a.createElement(ne,null,r.a.createElement(re,{rowName:"User ID",type:"text",disabled:!n.isNew,fullWidth:!0,name:n.isNew?"id":"",className:"id",value:n.state.id,origValue:n.props.entry.id,placeholder:"@fancybot:example.com",onChange:n.inputChange}),r.a.createElement(re,{rowName:"Homeserver",type:"text",name:"homeserver",value:n.state.homeserver,origValue:n.props.entry.homeserver,placeholder:"https://example.com",onChange:n.inputChange}),r.a.createElement(re,{rowName:"Access token",type:"text",name:"access_token",value:n.state.access_token,origValue:n.props.entry.access_token,placeholder:"MDAxYWxvY2F0aW9uIG1hdHJpeC5sb2NhbAowMDEzaWRlbnRpZmllc",onChange:n.inputChange}),r.a.createElement(re,{rowName:"Display name",type:"text",name:"displayname",value:n.state.displayname,origValue:n.props.entry.displayname,placeholder:"My fancy bot",onChange:n.inputChange}),r.a.createElement(re,{rowName:"Avatar URL",type:"text",name:"avatar_url",value:n.state.avatar_url,origValue:n.props.entry.avatar_url,placeholder:"mxc://example.com/mbmwyoTvPhEQPiCskcUsppko",onChange:n.inputChange}),r.a.createElement(se,{rowName:"Sync",active:n.state.sync,origActive:n.props.entry.sync,onToggle:function(e){return n.setState({sync:e})}}),r.a.createElement(se,{rowName:"Autojoin",active:n.state.autojoin,origActive:n.props.entry.autojoin,onToggle:function(e){return n.setState({autojoin:e})}}),r.a.createElement(se,{rowName:"Enabled",active:n.state.enabled,origActive:n.props.entry.enabled,onToggle:function(e){return n.setState({enabled:e,started:e&&n.state.started})}}))},n.renderPrefButtons=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"buttons"},!n.isNew&&r.a.createElement("button",{className:"delete ".concat(n.hasInstances?"disabled-bg":""),onClick:n.delete,disabled:n.loading||n.hasInstances,title:n.hasInstances?"Can't delete client that is in use":""},n.state.deleting?r.a.createElement(O,null):"Delete"),r.a.createElement("button",{className:"save",onClick:n.save,disabled:n.loading},n.state.saving?r.a.createElement(O,null):n.isNew?"Create":"Save")),n.renderLogButton(n.state.id),r.a.createElement("div",{className:"error"},n.state.error))},n.deleteFunc=V.deleteClient,n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"client"},this.renderSidebar(),r.a.createElement("div",{className:"info"},this.renderPreferences(),this.renderPrefButtons(),this.renderInstances())))}},{key:"entryKeys",get:function(){return["id","displayname","homeserver","avatar_url","access_token","sync","autojoin","enabled","started"]}},{key:"initialState",get:function(){return{id:"",displayname:"",homeserver:"",avatar_url:"",access_token:"",sync:!0,autojoin:!0,enabled:!0,started:!1,instances:[],uploadingAvatar:!1,saving:!1,deleting:!1,startingOrStopping:!1,error:""}}},{key:"clientInState",get:function(){var e=Object.assign({},this.state);return delete e.uploadingAvatar,delete e.saving,delete e.deleting,delete e.startingOrStopping,delete e.error,delete e.instances,e}},{key:"loading",get:function(){return this.state.saving||this.state.startingOrStopping||this.state.deleting}}]),t}(oe);me.ListEntry=function(e){var t=e.entry,n=["client","entry"];return t.enabled?t.started||n.push("stopped"):n.push("disabled"),r.a.createElement(G.a,{className:n.join(" "),to:"/client/".concat(t.id)},r.a.createElement("img",{className:"avatar",src:V.getAvatarURL(t),alt:""}),r.a.createElement("span",{className:"displayname"},t.displayname||t.id),r.a.createElement($,null))};var fe=Object(H.a)(me),ve=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).upload=function(){var e=Object(l.a)(o.a.mark(function e(t){var a,r,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.target.files[0],n.setState({uploadingAvatar:!0}),e.next=4,n.readFile(a);case 4:return r=e.sent,e.next=7,V.uploadPlugin(r,n.state.id);case 7:(s=e.sent).id?(n.isNew?n.props.history.push("/plugin/".concat(s.id)):n.setState({saving:!1,error:""}),n.props.onChange(s)):n.setState({saving:!1,error:s.error});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.deleteFunc=V.deletePlugin,n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"plugin"},!this.isNew&&r.a.createElement(ce,null,r.a.createElement(re,{rowName:"ID",type:"text",value:this.state.id,disabled:!0,className:"id"}),r.a.createElement(re,{rowName:"Version",type:"text",value:this.state.version,disabled:!0})),r.a.createElement("div",{className:"upload-box ".concat(this.state.uploading?"uploading":"")},r.a.createElement(he,{className:"upload"}),r.a.createElement("input",{className:"file-selector",type:"file",accept:"application/zip+mbp",onChange:this.upload,disabled:this.state.uploading||this.state.deleting,onDragEnter:function(e){return e.target.parentElement.classList.add("drag")},onDragLeave:function(e){return e.target.parentElement.classList.remove("drag")}}),this.state.uploading&&r.a.createElement(O,null)),!this.isNew&&r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{className:"delete ".concat(this.hasInstances?"disabled-bg":""),onClick:this.delete,disabled:this.loading||this.hasInstances,title:this.hasInstances?"Can't delete plugin that is in use":""},this.state.deleting?r.a.createElement(O,null):"Delete")),this.renderLogButton("loader.zip"),r.a.createElement("div",{className:"error"},this.state.error),this.renderInstances())}},{key:"initialState",get:function(){return{id:"",version:"",instances:[],uploading:!1,deleting:!1,error:""}}}]),t}(oe);ve.ListEntry=function(e){var t=e.entry;return r.a.createElement(G.a,{className:"plugin entry",to:"/plugin/".concat(t.id)},r.a.createElement("span",{className:"id"},t.id),r.a.createElement($,null))};var ge=Object(H.a)(ve),be=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"home"},"See sidebar to get started"),r.a.createElement("div",{className:"buttons"}))}}]),t}(a.Component),ye=n(102),Ee=n.n(ye),Oe=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).open=function(){return n.setState({open:!0})},n.close=function(){return n.setState({open:!1})},n.isOpen=function(){return n.state.open},n.state={open:!1},n.wrapper={clientWidth:9001},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this;return this.state.open&&r.a.createElement("div",{className:"modal-wrapper-wrapper",ref:function(t){return e.wrapper=t},onClick:function(){return e.wrapper.clientWidth>720&&e.close()}},r.a.createElement("div",{className:"modal-wrapper",onClick:function(e){return e.stopPropagation()}},r.a.createElement("button",{className:"close",onClick:this.close},"Close"),r.a.createElement("div",{className:"modal"},r.a.createElement(t.Context.Provider,{value:this},this.props.children))))}}]),t}(a.Component);Oe.Context=Object(a.createContext)(null);var ke=Oe,we=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(p.a)(t,[{key:"renderName",value:function(){var e=this.props.line;if(e.nameLink){var t=this.context;return r.a.createElement(M.a,{to:e.nameLink,onClick:t.close},e.name)}return e.name}},{key:"renderContent",value:function(){if(this.props.line.matrix_http_request){var e=this.props.line.matrix_http_request;return r.a.createElement(r.a.Fragment,null,e.method," ",e.path,r.a.createElement("div",{className:"content"},Object.entries(e.content).length>0&&r.a.createElement(Ee.a,{data:{content:e.content},hideRoot:!0})))}return this.props.line.msg}},{key:"onClickOpen",value:function(e,t){return function(){return V.debugOpenFileEnabled()&&V.debugOpenFile(e,t),!1}}},{key:"renderTimeTitle",value:function(){return this.props.line.time.toDateString()}},{key:"renderTime",value:function(){return r.a.createElement("a",{className:"time",title:this.renderTimeTitle(),href:"file:///".concat(this.props.line.pathname,":").concat(this.props.line.lineno),onClick:this.onClickOpen(this.props.line.pathname,this.props.line.lineno)},this.props.line.time.toLocaleTimeString("en-GB"))}},{key:"renderLevelName",value:function(){return r.a.createElement("span",{className:"level"},this.props.line.levelname)}},{key:"renderRow",value:function(e){return r.a.createElement("div",{className:"row ".concat(this.props.line.levelname.toLowerCase()," ").concat(this.unfocused)},this.renderTime(),this.renderLevelName(),r.a.createElement("span",{className:"logger"},this.renderName()),r.a.createElement("span",{className:"text"},e))}},{key:"renderExceptionInfo",value:function(){var e=this;if(!V.debugOpenFileEnabled())return this.props.line.exc_info;var t=[],n=this.props.line.exc_info.replace(/File "(.+)", line ([0-9]+), in (.+)/g,function(n,a,s,i){return t.push(r.a.createElement("a",{href:"file:///".concat(a,":").concat(s),onClick:e.onClickOpen(a,s)},'File "',a,'", line ',s,", in ",i)),"||EDGE||"});t.reverse();var a=[],s=0,i=!0,c=!1,o=void 0;try{for(var l,u=n.split("||EDGE||")[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var p=l.value;a.push(r.a.createElement(r.a.Fragment,{key:s++},p,t.pop()))}}catch(d){c=!0,o=d}finally{try{i||null==u.return||u.return()}finally{if(c)throw o}}return a}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.renderRow(this.renderContent()),this.props.line.exc_info&&this.renderRow(this.renderExceptionInfo()))}},{key:"unfocused",get:function(){return this.props.focus&&this.props.line.name!==this.props.focus?"unfocused":""}}]),t}(a.PureComponent);we.contextType=ke.Context;var Ne=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).linesRef=r.a.createRef(),n.linesBottomRef=r.a.createRef(),n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"getSnapshotBeforeUpdate",value:function(){return!(!this.linesRef.current||!this.linesBottomRef.current)&&t.isVisible(this.linesRef.current,this.linesBottomRef.current)}},{key:"componentDidUpdate",value:function(e,n,a){a&&t.scrollParentToChild(this.linesRef.current,this.linesBottomRef.current)}},{key:"componentDidMount",value:function(){this.linesRef.current&&this.linesBottomRef.current&&t.scrollParentToChild(this.linesRef.current,this.linesBottomRef.current)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"log",ref:this.linesRef},r.a.createElement("div",{className:"lines"},this.props.lines.map(function(t){return r.a.createElement(we,{key:t.id,line:t,focus:e.props.focus})})),r.a.createElement("div",{ref:this.linesBottomRef}))}}],[{key:"scrollParentToChild",value:function(e,n){var a=e.getBoundingClientRect(),r=n.getBoundingClientRect();t.isVisible(e,n)||e.scrollBy({top:r.top+e.scrollTop-a.top})}},{key:"isVisible",value:function(e,t){var n=e.getBoundingClientRect(),a=t.getBoundingClientRect();return a.top>=n.top&&a.top<=n.top+e.clientHeight}}]),t}(a.PureComponent),je=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).openLog=function(e){n.setState({logFocus:"string"===typeof e?e:null}),n.logModal.open()},n.renderNotFound=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"path";return r.a.createElement("div",{className:"not-found"},"Oops! I'm afraid that ",e," couldn't be found.")},n.state={instances:{},clients:{},plugins:{},sidebarOpen:!1,modalOpen:!1,logFocus:null,logLines:[]},n.logModal={open:function(){},isOpen:function(){return!1}},window.maubot=Object(D.a)(Object(D.a)(n)),n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.location!==e.location&&this.setState({sidebarOpen:!1})}},{key:"componentWillMount",value:function(){var e=Object(l.a)(o.a.mark(function e(){var t,n,a,r,s,i,c,l,u,p,d,h,m,f,v,g,b,y,E,O,k,w,N,j,x,S,C,L,P=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([V.getInstances(),V.getClients(),V.getPlugins(),V.updateDebugOpenFileEnabled()]);case 2:for(t=e.sent,n=Object(B.a)(t,3),a=n[0],r=n[1],s=n[2],i={},c=!0,l=!1,u=void 0,e.prev=11,p=a[Symbol.iterator]();!(c=(d=p.next()).done);c=!0)h=d.value,i[h.id]=h;e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),l=!0,u=e.t0;case 19:e.prev=19,e.prev=20,c||null==p.return||p.return();case 22:if(e.prev=22,!l){e.next=25;break}throw u;case 25:return e.finish(22);case 26:return e.finish(19);case 27:for(m={},f=!0,v=!1,g=void 0,e.prev=31,b=r[Symbol.iterator]();!(f=(y=b.next()).done);f=!0)E=y.value,m[E.id]=E;e.next=39;break;case 35:e.prev=35,e.t1=e.catch(31),v=!0,g=e.t1;case 39:e.prev=39,e.prev=40,f||null==b.return||b.return();case 42:if(e.prev=42,!v){e.next=45;break}throw g;case 45:return e.finish(42);case 46:return e.finish(39);case 47:for(O={},k=!0,w=!1,N=void 0,e.prev=51,j=s[Symbol.iterator]();!(k=(x=j.next()).done);k=!0)S=x.value,O[S.id]=S;e.next=59;break;case 55:e.prev=55,e.t2=e.catch(51),w=!0,N=e.t2;case 59:e.prev=59,e.prev=60,k||null==j.return||j.return();case 62:if(e.prev=62,!w){e.next=65;break}throw N;case 65:return e.finish(62);case 66:return e.finish(59);case 67:return this.setState({instances:i,clients:m,plugins:O}),e.next=70,V.openLogSocket();case 70:C=e.sent,L=function(e){e.time=new Date(e.time),e.name.startsWith("maubot.")&&(e.name=e.name.substr("maubot.".length)),e.name.startsWith("client.")?(e.name=e.name.substr("client.".length),e.nameLink="/client/".concat(e.name)):e.name.startsWith("instance.")&&(e.nameLink="/instance/".concat(e.name.substr("instance.".length)))},C.onHistory=function(e){var t=!0,n=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var i=r.value;L(i)}}catch(c){n=!0,a=c}finally{try{t||null==s.return||s.return()}finally{if(n)throw a}}P.setState({logLines:e})},C.onLog=function(e){L(e),P.setState({logLines:P.state.logLines.concat(e)})};case 74:case"end":return e.stop()}},e,this,[[11,15,19,27],[20,,22,26],[31,35,39,47],[40,,42,46],[51,55,59,67],[60,,62,66]])}));return function(){return e.apply(this,arguments)}}()},{key:"renderList",value:function(e,t){return this.state[e]&&Object.values(this.state[e]).map(function(e){return r.a.createElement(t,{key:e.id,entry:e})})}},{key:"delete",value:function(e,t){var n=Object.assign({},this.state[e]);delete n[t],this.setState(Object(W.a)({},e,n))}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,a=Object.assign({},this.state[e]);n&&n!==t.id&&delete a[n],a[t.id]=t,this.setState(Object(W.a)({},e,a))}},{key:"renderView",value:function(e,t,n){var a=this,s=this.state[e][n];return s?r.a.createElement(t,{entry:s,onDelete:function(){return a.delete(e,n)},onChange:function(t){return a.add(e,t,n)},openLog:this.openLog,ctx:this.state}):this.renderNotFound(e.slice(0,-1))}},{key:"renderMain",value:function(){var e=this;return r.a.createElement("div",{className:"dashboard ".concat(this.state.sidebarOpen?"sidebar-open":"")},r.a.createElement(M.a,{to:"/",className:"title"},r.a.createElement("img",{src:"favicon.png",alt:""}),"Maubot Manager"),r.a.createElement("div",{className:"user"},r.a.createElement("span",null,localStorage.username)),r.a.createElement("nav",{className:"sidebar"},r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{className:"open-log",onClick:this.openLog},r.a.createElement("span",null,"View logs"))),r.a.createElement("div",{className:"instances list"},r.a.createElement("div",{className:"title"},r.a.createElement("h2",null,"Instances"),r.a.createElement(M.a,{to:"/new/instance"},r.a.createElement(J,null))),this.renderList("instances",ue.ListEntry)),r.a.createElement("div",{className:"clients list"},r.a.createElement("div",{className:"title"},r.a.createElement("h2",null,"Clients"),r.a.createElement(M.a,{to:"/new/client"},r.a.createElement(J,null))),this.renderList("clients",fe.ListEntry)),r.a.createElement("div",{className:"plugins list"},r.a.createElement("div",{className:"title"},r.a.createElement("h2",null,"Plugins"),r.a.createElement(M.a,{to:"/new/plugin"},r.a.createElement(J,null))),this.renderList("plugins",ge.ListEntry))),r.a.createElement("div",{className:"topbar"},r.a.createElement("div",{className:"hamburger ".concat(this.state.sidebarOpen?"active":""),onClick:function(t){return e.setState({sidebarOpen:!e.state.sidebarOpen})}},r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null))),r.a.createElement("main",{className:"view"},r.a.createElement(v.a,null,r.a.createElement(b.a,{path:"/",exact:!0,render:function(){return r.a.createElement(be,{openLog:e.openLog})}}),r.a.createElement(b.a,{path:"/new/instance",render:function(){return r.a.createElement(ue,{onChange:function(t){return e.add("instances",t)},entry:{},ctx:e.state})}}),r.a.createElement(b.a,{path:"/new/client",render:function(){return r.a.createElement(fe,{entry:{},onChange:function(t){return e.add("clients",t)}})}}),r.a.createElement(b.a,{path:"/new/plugin",render:function(){return r.a.createElement(ge,{entry:{},onChange:function(t){return e.add("plugins",t)}})}}),r.a.createElement(b.a,{path:"/instance/:id",render:function(t){var n=t.match;return e.renderView("instances",ue,n.params.id)}}),r.a.createElement(b.a,{path:"/client/:id",render:function(t){var n=t.match;return e.renderView("clients",fe,n.params.id)}}),r.a.createElement(b.a,{path:"/plugin/:id",render:function(t){var n=t.match;return e.renderView("plugins",ge,n.params.id)}}),r.a.createElement(b.a,{render:function(){return e.renderNotFound()}}))))}},{key:"renderModal",value:function(){var e=this;return r.a.createElement(ke,{ref:function(t){return e.logModal=t}},r.a.createElement(Ne,{lines:this.state.logLines,focus:this.state.logFocus}))}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.renderMain(),this.renderModal())}}]),t}(a.Component),xe=Object(H.a)(je),Se=function(e){function t(e,n){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e,n))).inputChanged=function(e){return a.setState(Object(W.a)({},e.target.name,e.target.value))},a.login=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({loading:!0}),e.next=3,V.login(a.state.username,a.state.password);case 3:if(!(t=e.sent).token){e.next=9;break}return e.next=7,a.props.onLogin(t.token);case 7:e.next=10;break;case 9:t.error?a.setState({error:t.error,loading:!1}):(a.setState({error:"Unknown error",loading:!1}),console.log("Unknown error:",t));case 10:case"end":return e.stop()}},e,this)})),a.state={username:"",password:"",loading:!1,error:""},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"login-wrapper"},r.a.createElement("div",{className:"login ".concat(this.state.error&&"errored")},r.a.createElement("h1",null,"Maubot Manager"),r.a.createElement("input",{type:"text",placeholder:"Username",value:this.state.username,name:"username",onChange:this.inputChanged}),r.a.createElement("input",{type:"password",placeholder:"Password",value:this.state.password,name:"password",onChange:this.inputChanged}),r.a.createElement("button",{onClick:this.login},this.state.loading?r.a.createElement(O,null):"Log in"),this.state.error&&r.a.createElement("div",{className:"error"},this.state.error)))}}]),t}(a.Component),Ce=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).login=function(){var e=Object(l.a)(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.accessToken=t,e.next=3,n.ping();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.state={pinged:!1,authed:!1},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentWillMount",value:function(){var e=Object(l.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!localStorage.accessToken){e.next=3;break}return e.next=3,this.ping();case 3:this.setState({pinged:!0});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"ping",value:function(){var e=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.ping();case 3:(t=e.sent)?(localStorage.username=t,this.setState({authed:!0})):delete localStorage.accessToken,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.pinged?r.a.createElement(f.a,null,r.a.createElement("div",{className:"maubot-wrapper ".concat(this.state.authed?"authenticated":"")},r.a.createElement(v.a,null,r.a.createElement(E,{path:"/login",render:function(){return r.a.createElement(Se,{onLogin:e.login})},authed:!this.state.authed,to:"/"}),r.a.createElement(E,{path:"/",component:xe,authed:this.state.authed})))):r.a.createElement(O,{className:"maubot-loading"})}}]),t}(a.Component);i.a.render(r.a.createElement(Ce,null),document.getElementById("root"))}},[[107,2,1]]]);
//# sourceMappingURL=main.2156db29.chunk.js.map